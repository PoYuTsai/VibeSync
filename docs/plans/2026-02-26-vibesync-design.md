# VibeSync è¨­è¨ˆè¦æ ¼æ›¸

**å°ˆæ¡ˆåç¨±**: VibeSync é »ç‡èª¿æ ¡å¸«
**ç‰ˆæœ¬**: 1.0 MVP
**æ—¥æœŸ**: 2026-02-26
**ç‹€æ…‹**: è¨­è¨ˆå®Œæˆï¼Œå¾…å¯¦ä½œ

---

## 1. ç³»çµ±æ¶æ§‹ (System Architecture)

### 1.1 æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Flutter App                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   UI Layer  â”‚  â”‚   Domain    â”‚  â”‚     Data Layer      â”‚  â”‚
â”‚  â”‚  (Riverpod) â”‚  â”‚   Layer     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚  â”‚  Hive (Local) â”‚  â”‚  â”‚
â”‚  â”‚  - Screens  â”‚  â”‚  - UseCases â”‚  â”‚  â”‚  AES-256åŠ å¯†   â”‚  â”‚  â”‚
â”‚  â”‚  - Widgets  â”‚  â”‚  - Entities â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Supabase                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     Auth     â”‚  â”‚  PostgreSQL  â”‚  â”‚  Edge Functions  â”‚   â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚                  â”‚   â”‚
â”‚  â”‚ Google/Apple â”‚  â”‚ - users      â”‚  â”‚ - analyze-chat   â”‚   â”‚
â”‚  â”‚ Email OTP    â”‚  â”‚ - subs       â”‚  â”‚ - generate-reply â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼               â–¼               â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Claude  â”‚    â”‚ RevenueCatâ”‚   â”‚  Sentry      â”‚
       â”‚   API    â”‚    â”‚           â”‚   â”‚ (Monitoring) â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒå…ƒä»¶

| å…ƒä»¶ | æŠ€è¡“ | è·è²¬ |
|------|------|------|
| Mobile App | Flutter 3.x + Riverpod | UIã€æœ¬åœ°å„²å­˜ã€ç‹€æ…‹ç®¡ç† |
| Auth | Supabase Auth | èº«ä»½é©—è­‰ (Google/Apple/Email OTP) |
| Database | PostgreSQL | ç”¨æˆ¶è³‡æ–™ã€è¨‚é–±ç‹€æ…‹ |
| AI Gateway | Edge Functions | è«‹æ±‚è·¯ç”±ã€æ¨¡å‹é¸æ“‡ã€å®‰å…¨é©—è­‰ |
| AI Engine | Claude API | ç†±åº¦åˆ†æã€å›è¦†ç”Ÿæˆ |
| Subscription | RevenueCat | è¨‚é–±ç®¡ç†ã€æ”¶æ“šé©—è­‰ |

### 1.3 æŠ€è¡“é¸å‹ç†ç”±

- **Flutter**: ä¸€å¥—ç¨‹å¼ç¢¼æ”¯æ´ iOS/Androidï¼Œé–‹ç™¼æ•ˆç‡é«˜
- **Supabase**: é–‹æº Firebase æ›¿ä»£æ–¹æ¡ˆï¼ŒPostgreSQL åº•å±¤æ›´éˆæ´»
- **Edge Functions**: Serverlessï¼ŒæŒ‰ä½¿ç”¨é‡è¨ˆè²»ï¼Œè‡ªå‹•æ“´å±•
- **RevenueCat**: App Store/Play Store è¨‚é–±æ•´åˆæ¨™æº–æ–¹æ¡ˆ
- **Hive**: Flutter åŸç”Ÿ NoSQLï¼Œæ•ˆèƒ½å„ªæ–¼ SQLite

---

## 2. è³‡æ–™æ¨¡å‹ (Data Model)

### 2.1 æœ¬åœ°å„²å­˜ (Hive)

```dart
@HiveType(typeId: 0)
class Conversation extends HiveObject {
  @HiveField(0)
  late String id;

  @HiveField(1)
  late String name;          // å°è©±å°è±¡åç¨±

  @HiveField(2)
  late String? avatarPath;   // æœ¬åœ°åœ–ç‰‡è·¯å¾‘

  @HiveField(3)
  late List<Message> messages;

  @HiveField(4)
  late DateTime createdAt;

  @HiveField(5)
  late DateTime updatedAt;
}

@HiveType(typeId: 1)
class Message extends HiveObject {
  @HiveField(0)
  late String id;

  @HiveField(1)
  late String content;       // è¨Šæ¯å…§å®¹

  @HiveField(2)
  late bool isFromMe;        // æ˜¯å¦ç‚ºç”¨æˆ¶ç™¼é€

  @HiveField(3)
  late DateTime timestamp;

  @HiveField(4)
  late int? enthusiasmScore; // ç†±åº¦åˆ†æ•¸ (0-100)

  @HiveField(5)
  late List<String>? suggestedReplies; // AI å»ºè­°å›è¦†
}
```

### 2.2 é›²ç«¯å„²å­˜ (PostgreSQL)

```sql
-- ç”¨æˆ¶è³‡æ–™è¡¨
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT UNIQUE NOT NULL,
  display_name TEXT,
  avatar_url TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  last_login_at TIMESTAMPTZ,

  -- çµ±è¨ˆè³‡æ–™
  total_analyses INTEGER DEFAULT 0,
  total_conversations INTEGER DEFAULT 0
);

-- è¨‚é–±ç‹€æ…‹è¡¨
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  tier TEXT NOT NULL CHECK (tier IN ('free', 'pro', 'unlimited')),
  status TEXT NOT NULL CHECK (status IN ('active', 'expired', 'cancelled')),

  -- RevenueCat æ•´åˆ
  rc_customer_id TEXT,
  rc_entitlement_id TEXT,

  -- ä½¿ç”¨é‡è¿½è¹¤
  monthly_analyses_used INTEGER DEFAULT 0,
  monthly_reset_at TIMESTAMPTZ,

  started_at TIMESTAMPTZ DEFAULT NOW(),
  expires_at TIMESTAMPTZ,

  UNIQUE(user_id)
);

-- RLS æ”¿ç­–ï¼šç”¨æˆ¶åªèƒ½å­˜å–è‡ªå·±çš„è³‡æ–™
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE subscriptions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own data" ON users
  FOR SELECT USING (auth.uid() = id);

CREATE POLICY "Users can view own subscription" ON subscriptions
  FOR SELECT USING (auth.uid() = user_id);
```

### 2.3 è³‡æ–™æµå‘

```
ç”¨æˆ¶è¼¸å…¥å°è©± â†’ æœ¬åœ°åŠ å¯†å„²å­˜ (Hive)
                    â†“
            ç™¼é€è‡³ Edge Function
                    â†“
            Claude API åˆ†æ (ä¸å„²å­˜)
                    â†“
            è¿”å›çµæœçµ¦ App
                    â†“
            çµæœå­˜å…¥æœ¬åœ° Hive
```

**é—œéµåŸå‰‡**: å°è©±å…§å®¹ **æ°¸ä¸** å„²å­˜æ–¼ä¼ºæœå™¨

---

## 3. AI åˆ†æå¼•æ“ (AI Analysis Engine)

### 3.1 æ ¸å¿ƒå“²å­¸

#### 1.8x é»ƒé‡‘æ³•å‰‡ (The Golden Rule)

```
å›è¦†å­—æ•¸ â‰¤ å°æ–¹æœ€å¾Œä¸€å‰‡è¨Šæ¯å­—æ•¸ Ã— 1.8
```

é€™æ˜¯æœ€é«˜æŒ‡å°åŸå‰‡ï¼Œæ‰€æœ‰å»ºè­°å›è¦†éƒ½å¿…é ˆéµå®ˆã€‚

**ç†ç”±**:
- ç¶­æŒå°è©±å¹³è¡¡æ„Ÿ
- é¿å…éåº¦æŠ•å…¥ (Over-investing)
- å±•ç¾å¾å®¹ä¸è¿«çš„æ…‹åº¦
- ç¬¦åˆã€Œé«˜åƒ¹å€¼ã€å°è©±æ¨¡å¼

### 3.2 ç†±åº¦é‡è¡¨ (Enthusiasm Gauge)

| åˆ†æ•¸ç¯„åœ | ç­‰ç´šåç¨± | è¦–è¦ºæ¨™ç¤º | å»ºè­°ç­–ç•¥ |
|----------|----------|----------|----------|
| 0-30 | å†°é» | â„ï¸ è—è‰² | é¡åƒå†·è™•ç†ã€é©åº¦æŠ½é›¢ã€ç­‰å¾…æ™‚æ©Ÿ |
| 31-60 | æº«å’Œ | ğŸŒ¤ï¸ é»ƒè‰² | å¼•å°å¼æå•ã€æ‹‹å‡ºæœ‰è¶£è©±é¡Œã€DHV |
| 61-80 | ç†±æƒ… | ğŸ”¥ æ©˜è‰² | 80% é¡åƒã€ä¿æŒæ²‰ç©©ã€é©åº¦æ¨é€² |
| 81-100 | é«˜ç†± | ğŸ’– ç²‰ç´… | æ¨æ‹‰æŠ€å·§ã€é©åº¦æŒ‘æˆ°ã€å»ºç«‹æ¡†æ¶ |

### 3.3 ç†±åº¦åˆ†ææŒ‡æ¨™

```typescript
interface EnthusiasmAnalysis {
  score: number;           // 0-100
  level: 'cold' | 'warm' | 'hot' | 'very_hot';

  indicators: {
    responseSpeed: number;      // å›è¦†é€Ÿåº¦ (å·²ç§»é™¤ï¼Œç”¨æˆ¶åé¥‹ä¸»è§€)
    messageLength: number;      // è¨Šæ¯é•·åº¦æ¯”ä¾‹
    questionAsking: boolean;    // æ˜¯å¦ä¸»å‹•æå•
    emojiUsage: number;         // emoji ä½¿ç”¨é »ç‡
    initiationRatio: number;    // ä¸»å‹•ç™¼è¨Šæ¯”ä¾‹
    topicEngagement: number;    // è©±é¡Œåƒèˆ‡åº¦
  };

  warnings: NeedyWarning[];     // Needy è­¦ç¤º
}

interface NeedyWarning {
  type: 'double_text' | 'over_invest' | 'seeking_validation' | 'too_available';
  message: string;
  suggestion: string;
}
```

### 3.4 ä¸‰ç¨®å›è¦†é¡å‹

| é¡å‹ | ä¸­æ–‡å | ç”¨é€” | ç¯„ä¾‹æƒ…å¢ƒ |
|------|--------|------|----------|
| Extend | å»¶å±• | å»¶çºŒè©±é¡Œã€æŒ–æ˜æ·±åº¦ | å°æ–¹æåˆ°èˆˆè¶£ï¼Œè¿½å•ç´°ç¯€ |
| Resonate | å…±é³´ | æƒ…æ„Ÿé€£çµã€åŒç†å¿ƒ | å°æ–¹åˆ†äº«å¿ƒæƒ…ï¼Œçµ¦äºˆç†è§£ |
| Tease | èª¿æƒ… | è¼•é¬†ç©ç¬‘ã€å»ºç«‹å¼µåŠ› | é—œä¿‚å‡æº«ï¼Œé©åº¦æŒ‘é€— |

### 3.5 AI Prompt çµæ§‹

```typescript
const systemPrompt = `
ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„ç¤¾äº¤æºé€šæ•™ç·´ï¼Œå¹«åŠ©ç”¨æˆ¶æå‡å°è©±æŠ€å·§ã€‚

## æœ€é«˜æŒ‡å°åŸå‰‡ï¼š1.8x é»ƒé‡‘æ³•å‰‡
æ‰€æœ‰å»ºè­°å›è¦†çš„å­—æ•¸å¿…é ˆ â‰¤ å°æ–¹æœ€å¾Œè¨Šæ¯å­—æ•¸ Ã— 1.8
é€™æ¢è¦å‰‡ä¸å¯é•åã€‚

## ç†±åº¦åˆ†ææ¨™æº–
æ ¹æ“šä»¥ä¸‹æŒ‡æ¨™è©•ä¼°å°è©±ç†±åº¦ (0-100):
- è¨Šæ¯é•·åº¦è®ŠåŒ–
- æ˜¯å¦ä¸»å‹•æå•
- Emoji ä½¿ç”¨é »ç‡
- è©±é¡Œåƒèˆ‡æ·±åº¦
- ä¸»å‹•ç™¼èµ·å°è©±æ¯”ä¾‹

## å›è¦†ç”Ÿæˆè¦å‰‡
1. æ¯æ¬¡æä¾› 3 ç¨®å›è¦†ï¼šå»¶å±•ã€å…±é³´ã€èª¿æƒ…
2. æ ¹æ“šç†±åº¦ç­‰ç´šèª¿æ•´ç­–ç•¥
3. é¿å… Needy è¡Œç‚ºï¼š
   - é€£çºŒç™¼é€å¤šå‰‡è¨Šæ¯
   - éåº¦è§£é‡‹æˆ–é“æ­‰
   - å°‹æ±‚èªå¯çš„èªæ°£
   - ç§’å›æˆ–éåº¦ç©æ¥µ

## è¼¸å‡ºæ ¼å¼
{
  "enthusiasm": { "score": 75, "level": "hot" },
  "replies": {
    "extend": "...",
    "resonate": "...",
    "tease": "..."
  },
  "warnings": [],
  "strategy": "ç°¡çŸ­ç­–ç•¥èªªæ˜"
}
`;
```

### 3.6 æ··åˆæ¨¡å‹ç­–ç•¥

```typescript
function selectModel(context: AnalysisContext): 'haiku' | 'sonnet' {
  // ä½¿ç”¨ Sonnet çš„æƒ…æ³ (30%)
  if (
    context.conversationLength > 20 ||      // é•·å°è©±
    context.enthusiasmLevel === 'cold' ||   // å†·æ·¡éœ€è¦ç­–ç•¥
    context.hasComplexEmotions ||           // è¤‡é›œæƒ…ç·’
    context.isFirstAnalysis                 // é¦–æ¬¡åˆ†æå»ºç«‹åŸºæº–
  ) {
    return 'sonnet';
  }

  // é è¨­ä½¿ç”¨ Haiku (70%)
  return 'haiku';
}
```

---

## 4. UI/UX è¨­è¨ˆ (User Interface)

### 4.1 æ ¸å¿ƒç•«é¢

#### ç•«é¢ 1: å°è©±åˆ—è¡¨ (Home)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VibeSync          [+æ–°å¢]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” æœå°‹å°è©±...              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”                      â”‚
â”‚  â”‚ ğŸ‘¤â”‚ å°ç¾        æ˜¨å¤© 23:14â”‚
â”‚  â””â”€â”€â”€â”˜ ç†±åº¦: ğŸ”¥ 72          â”‚
â”‚        æœ€å¾Œï¼šå“ˆå“ˆå¥½å•Šï½      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”                      â”‚
â”‚  â”‚ ğŸ‘¤â”‚ Amy         å‰å¤©     â”‚
â”‚  â””â”€â”€â”€â”˜ ç†±åº¦: â„ï¸ 28          â”‚
â”‚        æœ€å¾Œï¼šå—¯              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚      [ å‡ç´š Pro è§£é–æ›´å¤š ]   â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç•«é¢ 2: å°è©±åˆ†æ (Analysis)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† å°ç¾           [åˆ†æä¸­...]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ å¥¹: é€±æœ«æœ‰ä»€éº¼è¨ˆç•«å—ï¼Ÿ   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æˆ‘: å¯èƒ½å»çˆ¬å±±ï¼Œå¦³å‘¢ï¼Ÿ   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ å¥¹: å“‡å¡æˆ‘ä¹Ÿè¶…æ„›çˆ¬å±±çš„ï¼ â”‚â”‚
â”‚  â”‚     æœ€è¿‘å»äº†æŠ¹èŒ¶å±±è¶…ç¾ï½ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç†±åº¦åˆ†æ                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ğŸ”¥ 72/100  ç†±æƒ…        â”‚â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚
â”‚  ğŸ’¡ ç­–ç•¥ï¼šå¥¹æœ‰èˆˆè¶£ä¸”ä¸»å‹•åˆ†äº« â”‚
â”‚     ä¿æŒæ²‰ç©©ï¼Œ80%é¡åƒå³å¯   â”‚
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å»ºè­°å›è¦† (å­—æ•¸ä¸Šé™: 32å­—)   â”‚
â”‚                             â”‚
â”‚  [å»¶å±•] æŠ¹èŒ¶å±±ä¸éŒ¯æ¬¸ï¼Œ        â”‚
â”‚        ä¸‹æ¬¡å¯ä»¥æŒ‘æˆ°æ›´é›£çš„    â”‚
â”‚                     [è¤‡è£½]  â”‚
â”‚                             â”‚
â”‚  [å…±é³´] æŠ¹èŒ¶å±±è¶…è®šï¼         â”‚
â”‚        ç…§ç‰‡ä¸€å®šå¾ˆç¾å§       â”‚
â”‚                     [è¤‡è£½]  â”‚
â”‚                             â”‚
â”‚  [èª¿æƒ…] è½èµ·ä¾†å¦³å¾ˆæœƒæŒ‘åœ°æ–¹å˜› â”‚
â”‚        æ”¹å¤©å¸¶è·¯ï¼Ÿ           â”‚
â”‚                     [è¤‡è£½]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç•«é¢ 3: è¼¸å…¥å°è©± (Input)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† æ–°å¢å°è©±                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚  å°è©±å°è±¡æš±ç¨±                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ å°ç¾                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚
â”‚  è²¼ä¸Šå°è©±å…§å®¹                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ å¥¹: ä½ å¥½                 â”‚â”‚
â”‚  â”‚ æˆ‘: å—¨                   â”‚â”‚
â”‚  â”‚ å¥¹: åœ¨å¹¹å˜›               â”‚â”‚
â”‚  â”‚ æˆ‘: å·¥ä½œä¸­ï¼Œå¦³å‘¢         â”‚â”‚
â”‚  â”‚ å¥¹: é€±æœ«æœ‰ä»€éº¼è¨ˆç•«å—ï¼Ÿ   â”‚â”‚
â”‚  â”‚ ...                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚
â”‚  â„¹ï¸ æ ¼å¼ï¼šæ¯è¡Œä¸€å‰‡è¨Šæ¯       â”‚
â”‚     ä»¥ã€Œå¥¹:ã€æˆ–ã€Œæˆ‘:ã€é–‹é ­   â”‚
â”‚                             â”‚
â”‚         [ é–‹å§‹åˆ†æ ]         â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç•«é¢ 4: è¨­å®š (Settings)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¨­å®š                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚  å¸³æˆ¶                        â”‚
â”‚  â”œâ”€ è¨‚é–±æ–¹æ¡ˆ     Pro âœ“      â”‚
â”‚  â”œâ”€ æœ¬æœˆç”¨é‡     47/200     â”‚
â”‚  â””â”€ å¸³è™Ÿ         user@...   â”‚
â”‚                             â”‚
â”‚  åå¥½è¨­å®š                    â”‚
â”‚  â”œâ”€ èªè¨€         ç¹é«”ä¸­æ–‡   â”‚
â”‚  â”œâ”€ æ·±è‰²æ¨¡å¼     é–‹å•Ÿ       â”‚
â”‚  â””â”€ é€šçŸ¥         é—œé–‰       â”‚
â”‚                             â”‚
â”‚  éš±ç§èˆ‡å®‰å…¨                  â”‚
â”‚  â”œâ”€ æ¸…é™¤æ‰€æœ‰å°è©±è³‡æ–™         â”‚
â”‚  â”œâ”€ åŒ¯å‡ºæˆ‘çš„è³‡æ–™             â”‚
â”‚  â””â”€ éš±ç§æ¬Šæ”¿ç­–               â”‚
â”‚                             â”‚
â”‚  é—œæ–¼                        â”‚
â”‚  â”œâ”€ ç‰ˆæœ¬         1.0.0      â”‚
â”‚  â”œâ”€ ä½¿ç”¨æ¢æ¬¾                 â”‚
â”‚  â””â”€ æ„è¦‹å›é¥‹                 â”‚
â”‚                             â”‚
â”‚        [ ç™»å‡º ]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è¨­è¨ˆç³»çµ±

#### è‰²å½©ç³»çµ±
```dart
class AppColors {
  // ä¸»è‰²èª¿ - æ·±ç´« (å°ˆæ¥­ã€ç¥ç§˜)
  static const primary = Color(0xFF6B4EE6);
  static const primaryLight = Color(0xFF9D8DF7);
  static const primaryDark = Color(0xFF4527A0);

  // ç†±åº¦ç­‰ç´šè‰²å½©
  static const cold = Color(0xFF64B5F6);      // è—
  static const warm = Color(0xFFFFD54F);      // é»ƒ
  static const hot = Color(0xFFFF8A65);       // æ©˜
  static const veryHot = Color(0xFFFF6B9D);   // ç²‰ç´…

  // ä¸­æ€§è‰²
  static const background = Color(0xFF121212);
  static const surface = Color(0xFF1E1E1E);
  static const textPrimary = Color(0xFFFFFFFF);
  static const textSecondary = Color(0xFFB3B3B3);
}
```

#### å­—å‹ç³»çµ±
```dart
class AppTypography {
  static const headlineLarge = TextStyle(
    fontSize: 28,
    fontWeight: FontWeight.bold,
  );

  static const bodyLarge = TextStyle(
    fontSize: 16,
    height: 1.5,
  );

  static const caption = TextStyle(
    fontSize: 12,
    color: AppColors.textSecondary,
  );
}
```

---

## 5. å®‰å…¨èˆ‡åˆè¦ (Security & Compliance)

### 5.1 App Store å¯©æ ¸ç­–ç•¥

#### å®šä½èªªæ˜
- **App Store åˆ†é¡**: Social Networking / Lifestyle
- **æ‡‰ç”¨æè¿°**: ç¤¾äº¤æºé€šæŠ€å·§æ•™ç·´ï¼Œå¹«åŠ©ç”¨æˆ¶æå‡å°è©±å“è³ª
- **é¿å…ç”¨è©**: æŠŠå¦¹ã€æ­è¨•ã€ç´„æœƒã€æˆ€æ„›æŠ€å·§
- **æ¡ç”¨ç”¨è©**: ç¤¾äº¤æŠ€å·§ã€æºé€šèƒ½åŠ›ã€äººéš›é—œä¿‚ã€å°è©±å“è³ª

#### é—œéµåˆè¦é»
1. âœ… ä¸å­˜å„²ä»–äººå°è©±æ–¼ä¼ºæœå™¨
2. âœ… ç”¨æˆ¶å®Œå…¨æ§åˆ¶æœ¬åœ°è³‡æ–™
3. âœ… æä¾›è³‡æ–™åˆªé™¤åŠŸèƒ½
4. âœ… è¨‚é–±åƒ¹æ ¼é€æ˜
5. âœ… ä¸ä½¿ç”¨ã€Œæ“æ§ã€ç›¸é—œç”¨èª

### 5.2 éš±ç§ä¿è­·

```dart
class PrivacyManager {
  /// æœ¬åœ°åŠ å¯†é‡‘é‘° (ç”± Hive è‡ªå‹•ç®¡ç†)
  static const encryptionCipher = HiveAesCipher(key);

  /// è³‡æ–™ä¿ç•™æ”¿ç­–
  static const dataRetentionDays = 90; // 90å¤©æœªä½¿ç”¨è‡ªå‹•æ¸…ç†

  /// åŒ¯å‡ºç”¨æˆ¶è³‡æ–™ (GDPR åˆè¦)
  Future<File> exportUserData() async {
    final conversations = await getLocalConversations();
    final json = jsonEncode(conversations);
    return saveToFile(json);
  }

  /// å®Œå…¨åˆªé™¤æ‰€æœ‰è³‡æ–™
  Future<void> deleteAllData() async {
    await Hive.deleteBoxFromDisk('conversations');
    await Hive.deleteBoxFromDisk('settings');
    await supabase.auth.signOut();
  }
}
```

### 5.3 API å®‰å…¨

```typescript
// Edge Function å®‰å…¨æª¢æŸ¥
async function validateRequest(req: Request) {
  // 1. é©—è­‰ JWT
  const token = req.headers.get('Authorization');
  const { user, error } = await supabase.auth.getUser(token);
  if (error) throw new UnauthorizedError();

  // 2. æª¢æŸ¥è¨‚é–±ç‹€æ…‹
  const { data: sub } = await supabase
    .from('subscriptions')
    .select('tier, monthly_analyses_used')
    .eq('user_id', user.id)
    .single();

  // 3. æª¢æŸ¥ç”¨é‡é™åˆ¶
  const limit = TIER_LIMITS[sub.tier];
  if (sub.monthly_analyses_used >= limit) {
    throw new QuotaExceededError();
  }

  // 4. Rate limiting (IP + User)
  await checkRateLimit(user.id, req.ip);
}
```

---

## 6. è¨‚é–±ç­–ç•¥ (Subscription Strategy)

### 6.1 å®šåƒ¹æ–¹æ¡ˆ (è¨Šæ¯åˆ¶) âœ… æœ€çµ‚ç‰ˆ

> **è¨ˆè²»é‚è¼¯ï¼š1 å‰‡è¨Šæ¯ = 1 è¨Šæ¯é¡åº¦**
> **ç­–ç•¥ï¼šåˆç†å®šåƒ¹ï¼Œå‰æœŸ 10-25 ä»˜è²»ç”¨æˆ¶å³å¯æ‰“å¹³**

| æ–¹æ¡ˆ | æœˆè²» | USD | è¨Šæ¯/æœˆ | æ¯æ—¥ä¸Šé™ |
|------|------|-----|---------|----------|
| **Free** | NT$0 | $0 | 50 | 30 |
| **Starter** | **NT$199** | **$6** | **500** | 100 |
| **Pro** | **NT$399** | **$12** | **1,500** | 200 |
| **Business** | NT$799 | $25 | 4,000 | 500 |

### 6.2 åŠŸèƒ½å°ç…§è¡¨

| åŠŸèƒ½ | Free | Starter | Pro | Business |
|------|------|---------|-----|----------|
| è¨Šæ¯é¡åº¦/æœˆ | 50 | 500 | 1,500 | 4,000 |
| æ¯æ—¥ä¸Šé™ | 30 | 100 | 200 | 500 |
| ç†±åº¦åˆ†æ | âœ“ | âœ“ | âœ“ | âœ“ |
| å»¶å±•å›è¦† | âœ“ | âœ“ | âœ“ | âœ“ |
| å…±é³´å›è¦† | âœ— | âœ“ | âœ“ | âœ“ |
| èª¿æƒ…å›è¦† | âœ— | âœ“ | âœ“ | âœ“ |
| Needy è­¦ç¤º | âœ— | âœ“ | âœ“ | âœ“ |
| å°è©±æ­·å² | 3 | 10 | 30 | 100 |
| æ¨¡å‹ | Haiku | æ··åˆ | Sonnet | Sonnet |
| å…è²»è©¦ç”¨ | - | 7å¤© | 7å¤© | 7å¤© |

### 6.3 æˆæœ¬èˆ‡æç›Š

| æ–¹æ¡ˆ | æœˆè²» | æˆ‘å€‘æˆæœ¬ | æ¯›åˆ©ç‡ |
|------|------|----------|--------|
| Starter | NT$199 | ~NT$16 | 92% |
| Pro | NT$399 | ~NT$48 | 88% |
| Business | NT$799 | ~NT$128 | 84% |

**å‰æœŸæç›Šå¹³è¡¡ï¼š10-25 å€‹ä»˜è²»ç”¨æˆ¶**

### 6.4 åŠ è³¼è¨Šæ¯åŒ…

| è¨Šæ¯åŒ… | åƒ¹æ ¼ | æ¯å‰‡æˆæœ¬ |
|--------|------|----------|
| 100 å‰‡ | NT$49 | NT$0.49 |
| 300 å‰‡ | NT$129 | NT$0.43 |
| 500 å‰‡ | NT$199 | NT$0.40 |

### 6.5 å…è²»è©¦ç”¨
- æ‰€æœ‰ä»˜è²»æ–¹æ¡ˆäº« **7 å¤©å…è²»è©¦ç”¨**
- è©¦ç”¨æœŸé–“å¯éš¨æ™‚å–æ¶ˆ
- è©¦ç”¨çµæŸè‡ªå‹•æ‰£æ¬¾

### 6.6 å®¢æœç®¡é“
- ğŸ“§ Email: support@vibesync.app
- ğŸ’¬ LINE å®˜æ–¹å¸³è™Ÿ: @vibesync
- ğŸ“ App å…§å›é¥‹è¡¨å–®

### 6.7 é¦–ç™¼å¸‚å ´
- å°ç£å„ªå…ˆ (ç¹é«”ä¸­æ–‡)

### 6.4 RevenueCat æ•´åˆ

```dart
class SubscriptionService {
  final _purchases = Purchases.instance;

  Future<void> initialize() async {
    await Purchases.setLogLevel(LogLevel.debug);

    PurchasesConfiguration config = PurchasesConfiguration(
      Platform.isIOS
        ? 'appl_xxxxxxxx'  // App Store key
        : 'goog_xxxxxxxx', // Play Store key
    );

    await Purchases.configure(config);
  }

  Future<SubscriptionTier> getCurrentTier() async {
    final customerInfo = await _purchases.getCustomerInfo();

    if (customerInfo.entitlements.active.containsKey('unlimited')) {
      return SubscriptionTier.unlimited;
    } else if (customerInfo.entitlements.active.containsKey('pro')) {
      return SubscriptionTier.pro;
    }
    return SubscriptionTier.free;
  }

  Future<void> purchasePro() async {
    final offerings = await _purchases.getOfferings();
    final package = offerings.current?.getPackage('pro_monthly');
    if (package != null) {
      await _purchases.purchasePackage(package);
    }
  }
}
```

---

## 7. æŠ€è¡“å †ç–Šæ‘˜è¦ & MVP ç¯„åœ

### 7.1 æŠ€è¡“å †ç–Šç¸½è¦½

| å±¤ç´š | æŠ€è¡“ | ç”¨é€” |
|------|------|------|
| **Frontend** | Flutter 3.x | è·¨å¹³å° UI |
| | Riverpod | ç‹€æ…‹ç®¡ç† |
| | Hive | æœ¬åœ°åŠ å¯†å„²å­˜ |
| | go_router | è·¯ç”±ç®¡ç† |
| **Backend** | Supabase | BaaS å¹³å° |
| | PostgreSQL | ç”¨æˆ¶/è¨‚é–±è³‡æ–™ |
| | Edge Functions | Serverless API |
| **AI** | Claude API | Haiku + Sonnet |
| **Payment** | RevenueCat | è¨‚é–±ç®¡ç† |
| **Monitoring** | Sentry | éŒ¯èª¤è¿½è¹¤ |

### 7.2 MVP åŠŸèƒ½ç¯„åœ

#### åŒ…å« âœ…
1. ç”¨æˆ¶è¨»å†Š/ç™»å…¥ (Googleã€Appleã€Email OTP)
2. å°è©±è¤‡è£½è²¼ä¸Šè¼¸å…¥
3. ç†±åº¦åˆ†æ (0-100 + å››ç­‰ç´š)
4. ä¸‰ç¨®å›è¦†å»ºè­° (å»¶å±•/å…±é³´/èª¿æƒ…)
5. 1.8x é»ƒé‡‘æ³•å‰‡å­—æ•¸é™åˆ¶
6. Needy è¡Œç‚ºè­¦ç¤º
7. æœ¬åœ°åŠ å¯†å„²å­˜å°è©±
8. ä¸‰ç´šè¨‚é–± (Free/Pro/Unlimited)
9. æ·±è‰²æ¨¡å¼ UI

#### ä¸åŒ…å« (V2) âŒ
- Keyboard Extension
- Share Extension
- åœ–ç‰‡/æˆªåœ–åˆ†æ
- å¤šèªè¨€æ”¯æ´
- ç¤¾ç¾¤åŠŸèƒ½
- AI å€‹æ€§åŒ–èª¿æ•´

### 7.3 å°ˆæ¡ˆçµæ§‹

```
vibesync/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ main.dart
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ app.dart
â”‚   â”‚   â””â”€â”€ routes.dart
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â”œâ”€â”€ theme/
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ extensions/
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚   â”œâ”€â”€ conversation/
â”‚   â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚   â”œâ”€â”€ analysis/
â”‚   â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚   â””â”€â”€ subscription/
â”‚   â”‚       â”œâ”€â”€ data/
â”‚   â”‚       â”œâ”€â”€ domain/
â”‚   â”‚       â””â”€â”€ presentation/
â”‚   â””â”€â”€ shared/
â”‚       â””â”€â”€ widgets/
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ functions/
â”‚   â”‚   â”œâ”€â”€ analyze-chat/
â”‚   â”‚   â””â”€â”€ generate-reply/
â”‚   â””â”€â”€ migrations/
â”œâ”€â”€ test/
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ plans/
â”œâ”€â”€ pubspec.yaml
â”œâ”€â”€ CLAUDE.md
â””â”€â”€ README.md
```

---

## é™„éŒ„ A: MK æ¡†æ¶æ•´åˆè¦é»

åŸºæ–¼ã€ŠMKæŠŠå¦¹ç­†è¨˜è¬›ç¾©ã€‹ï¼Œä»¥ä¸‹æ¡†æ¶æ¦‚å¿µå°‡æ•´åˆè‡³ AI æç¤ºï¼š

1. **å¸å¼•åŠ›éšæ®µåˆ¤æ–·** - åˆ†æå°è©±è™•æ–¼å“ªå€‹éšæ®µ
2. **DHV (å±•ç¤ºé«˜åƒ¹å€¼)** - è­˜åˆ¥è‡ªç„¶å±•ç¤ºæ©Ÿæœƒ
3. **Needy æ¨¡å¼è­˜åˆ¥** - è­¦ç¤ºéåº¦æŠ•å…¥è¡Œç‚º
4. **æ¨æ‹‰æŠ€å·§** - åœ¨é©ç•¶ç†±åº¦æ™‚å»ºè­°ä½¿ç”¨
5. **æ¡†æ¶è¨­å®š** - å¹«åŠ©å»ºç«‹æœ‰åˆ©çš„å°è©±å‹•æ…‹

---

## è®Šæ›´è¨˜éŒ„

| æ—¥æœŸ | ç‰ˆæœ¬ | è®Šæ›´å…§å®¹ |
|------|------|----------|
| 2026-02-26 | 1.0 | åˆå§‹è¨­è¨ˆå®Œæˆ |

---

**æ–‡ä»¶çµæŸ**
